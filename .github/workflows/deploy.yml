name: Deploy React Tic Tac Toe to EC2

on:
  push:
    branches: [ "main" ]

jobs:
  build-and-deploy:
    runs-on: self-hosted   # your EC2 runner

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Install dependencies
      run: npm install

    - name: Build React app
      run: npm run build

    - name: Deploy with PM2 + Serve
      run: |
        # Stop old version (ignore error if not running)
        pm2 delete tic-tac-toe || true

        # Serve the build folder on port 3000
        pm2 start npx --name "tic-tac-toe" -- serve -s build -l 3000

        # Save PM2 config so it auto-starts after reboot
        pm2 save
